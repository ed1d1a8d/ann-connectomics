Adapted from https://github.com/karpathy/minGPT/tree/7218bcfa527c65f164de791099de715b81a95106.
We allow creation of model with device='meta' to be efficient.
